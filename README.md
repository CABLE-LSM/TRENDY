[//]: # (Author: Lachlan Whyborn)
[//]: # (Date Modified: )

# TRENDY v12 Experiment Configuration

This repository contains the auxiliary scripts required to run the TRENDY configuration on the RP23 NCI project on Gadi.

## Overview

CABLE configurations generally consist of multiple stages. There are two "types" of stage:
* Single step stages, where a given simulation is run once with a set of namelist options and restarts then move to the next stage.
* Multi-step stages, usually 2 steps, where a pair of linked simulations are cycled through a set number of times before moving on to the next stage.

## Complications

There are some complications which make the process more difficult to replicate. First, not all the restarts generated by a given stage are used by the next stage, instead may be passed forward some number of stages. Second, some of the input restarts and output restarts are not given separate filenames i.e. the input restart file is clobbered by the output restart file. Third, the multi-step stages don't always run their internal stages an equal number of times.

An example of this unequal multi-step is the spin-up of the nitrogen and phosphorous pools (we'll call them ```N_P_Spinup_1``` and ```N_P_Spinup_2```). It is possible to specify step 1 to run 4 times, and step 2 to run 2 times. The stage then consists of:

```N_P_Spinup_1``` &rarr ```N_P_Spinup_2``` &rarr ```N_P_Spinup_1``` &rarr ```N_P_Spinup_2``` &rarr ```N_P_Spinup_1``` &rarr ```N_P_Spinup_1```

## Usage

The new configuration is controlled by a combination of a shell script and set of namelists. In the shell script, the names of each stage are specified as an array with the variable ```STAGE_NAMES```. The ```STAGE_NAMES``` set the names of the Fortran namelists to read and the directory to write the results to. The Fortran namelists are a merge of the master namelists, in the ```namelists``` directory, and the namelists in ```stage_configurations```. The namelist in ```stage_configurations``` takes precedence.
